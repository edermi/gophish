var labels={"In progress":"label-primary",Queued:"label-info",Completed:"label-success","Emails Sent":"label-success",Error:"label-danger"},static_campaigns=[],static_campaign={};function launch(){swal({title:"Are you sure?",text:"This will schedule the campaign to be launched.",type:"question",animation:!1,showCancelButton:!0,confirmButtonText:"Launch",confirmButtonColor:"#428bca",reverseButtons:!0,allowOutsideClick:!1,showLoaderOnConfirm:!0,preConfirm:function(){return new Promise(function(t,a){static_campaign={name:$("#name").val(),url:$("#url").val(),page:{name:$("#page").select2("data")[0].text},launch_date:moment($("#launch_date").val(),"MMMM Do YYYY, h:mm a").utc().format()},api.static_campaigns.post(static_campaign).success(function(a){t(),static_campaign=a}).error(function(a){$("#modal\\.flashes").empty().append('<div style="text-align:center" class="alert alert-danger">            <i class="fa fa-exclamation-circle"></i> '+a.responseJSON.message+"</div>"),swal.close()})})}}).then(function(){swal("Campaign Scheduled!","This campaign has been scheduled for launch!","success"),$('button:contains("OK")').on("click",function(){window.location="/static_campaigns/"+static_campaign.id.toString()})})}function dismiss(){$("#modal\\.flashes").empty(),$("#name").val(""),$("#page").val("").change(),$("#url").val(""),$("#profile").val("").change(),$("#modal").modal("hide")}function deleteCampaign(a){swal({title:"Are you sure?",text:"This will delete the campaign. This can't be undone!",type:"warning",animation:!1,showCancelButton:!0,confirmButtonText:"Delete "+static_campaigns[a].name,confirmButtonColor:"#428bca",reverseButtons:!0,allowOutsideClick:!1,preConfirm:function(){return new Promise(function(t,e){api.static_campaignId.delete(static_campaigns[a].id).success(function(a){t()}).error(function(a){e(a.responseJSON.message)})})}}).then(function(){swal("Campaign Deleted!","This campaign has been deleted!","success"),$('button:contains("OK")').on("click",function(){location.reload()})})}function setupOptions(){api.pages.get().success(function(a){if(0==a.length)return modalError("No pages found!"),!1;var t=$.map(a,function(a){return a.text=a.name,a}),e=$("#page.form-control");e.select2({placeholder:"Select a Landing Page",data:t}),1===a.length&&(e.val(t[0].id),e.trigger("change.select2"))})}function edit(a){setupOptions()}function copy(a){setupOptions(),api.static_campaignId.get(static_campaigns[a].id).success(function(a){$("#name").val("Copy of "+a.name),a.page.id?($("#page").val(a.page.id.toString()),$("#page").trigger("change.select2")):$("#page").select2({placeholder:a.page.name}),$("#url").val(a.url)}).error(function(a){$("#modal\\.flashes").empty().append('<div style="text-align:center" class="alert alert-danger">            <i class="fa fa-exclamation-circle"></i> '+a.responseJSON.message+"</div>")})}$(document).ready(function(){$("#launch_date").datetimepicker({widgetPositioning:{vertical:"bottom"},showTodayButton:!0,defaultDate:moment(),format:"MMMM Do YYYY, h:mm a"}),$("#send_by_date").datetimepicker({widgetPositioning:{vertical:"bottom"},showTodayButton:!0,useCurrent:!1,format:"MMMM Do YYYY, h:mm a"}),$(".modal").on("hidden.bs.modal",function(a){$(this).removeClass("fv-modal-stack"),$("body").data("fv_open_modals",$("body").data("fv_open_modals")-1)}),$(".modal").on("shown.bs.modal",function(a){void 0===$("body").data("fv_open_modals")&&$("body").data("fv_open_modals",0),$(this).hasClass("fv-modal-stack")||($(this).addClass("fv-modal-stack"),$("body").data("fv_open_modals",$("body").data("fv_open_modals")+1),$(this).css("z-index",1040+10*$("body").data("fv_open_modals")),$(".modal-backdrop").not(".fv-modal-stack").css("z-index",1039+10*$("body").data("fv_open_modals")),$(".modal-backdrop").not("fv-modal-stack").addClass("fv-modal-stack"))}),$(document).on("hidden.bs.modal",".modal",function(){$(".modal:visible").length&&$(document.body).addClass("modal-open")}),$("#modal").on("hidden.bs.modal",function(a){dismiss()}),api.static_campaigns.summary().success(function(a){static_campaigns=a.campaigns,$("#loading").hide(),0<static_campaigns.length?($("#campaignTable").show(),$("#campaignTableArchive").show(),campaignTableOriginal=$("#campaignTable").DataTable({columnDefs:[{orderable:!1,targets:"no-sort"}],order:[[1,"desc"]]}),campaignTableArchive=$("#campaignTableArchive").DataTable({columnDefs:[{orderable:!1,targets:"no-sort"}],order:[[1,"desc"]]}),$.each(static_campaigns,function(a,t){if(campaignTable=campaignTableOriginal,"Completed"===t.status&&(campaignTable=campaignTableArchive),label=labels[t.status]||"label-default",moment(static_campaign.launch_date).isAfter(moment()))var e="Scheduled to start: "+moment(static_campaign.launch_date).format("MMMM Do YYYY, h:mm:ss a")+"<br><br>Number of recipients: "+static_campaign.stats.total;else"Launch Date: "+moment(static_campaign.launch_date).format("MMMM Do YYYY, h:mm:ss a");campaignTable.row.add([escapeHtml(t.name),moment(t.created_date).format("MMMM Do YYYY, h:mm:ss a"),'<span class="label '+label+'" data-toggle="tooltip" data-placement="right" data-html="true" title="'+e+'">'+t.status+"</span>","<div class='pull-right'><a class='btn btn-primary' href='/static_campaigns/"+t.id+"' data-toggle='tooltip' data-placement='left' title='View Results'>                    <i class='fa fa-bar-chart'></i>                    </a>            <span data-toggle='modal' data-backdrop='static' data-target='#modal'><button class='btn btn-primary' data-toggle='tooltip' data-placement='left' title='Copy Campaign' onclick='copy("+a+")'>                    <i class='fa fa-copy'></i>                    </button></span>                    <button class='btn btn-danger' onclick='deleteCampaign("+a+")' data-toggle='tooltip' data-placement='left' title='Delete Campaign'>                    <i class='fa fa-trash-o'></i>                    </button></div>"]).draw(),$('[data-toggle="tooltip"]').tooltip()})):$("#emptyMessage").show()}).error(function(){$("#loading").hide(),errorFlash("Error fetching campaigns")}),$.fn.select2.defaults.set("width","100%"),$.fn.select2.defaults.set("dropdownParent",$("#modal_body")),$.fn.select2.defaults.set("theme","bootstrap"),$.fn.select2.defaults.set("sorter",function(a){return a.sort(function(a,t){return a.text.toLowerCase()>t.text.toLowerCase()?1:a.text.toLowerCase()<t.text.toLowerCase()?-1:0})})});